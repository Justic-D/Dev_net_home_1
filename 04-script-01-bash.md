# Домашнее задание к занятию  
## 4.1  
#### Командная оболочка Bash: Практические навыки  
1. *Есть скрипт:*  
```shell
a=1
b=2
c=a+b
d=$a+$b
e=$(($a+$b))
```  
- Какие значения переменным c,d,e будут присвоены?  
- Почему?  

**Ответ:**  
 - `c=a+b` вернет `a+b`, т.к. `a` и `b` без символа `$`, `+` воспринимается как оператор только в арифметических операциях  
```shell
$ a=1
$ b=2
$ c=a+b
$ echo $c
a+b
```  
 - `d=$a+$b` вернет `1+2`, т.к. `a` и `b` с символом `$` будут восприниматься как обращения к переменным  
```shell
$ d=$a+$b
$ echo $d
1+2
```  
 - `e=$(($a+$b))` вернет `3`, т.к. конструкция `((..))` служит для арифметических операций  
```shell
$ e=$(($a+$b))
$ echo $e
3
```  
2. *На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным. В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:*  
```shell
  while ((1==1)
  do
    curl https://localhost:4757
    if (($? != 0))
    then
      date >> curl.log
    fi
  done
```  
**Ответ:**  
```shell
  while ((1==1))                #не было закрывающей скобки
  do
    curl https://localhost:4757
    if (($? != 0))
    then
      date >> curl.log
    else                        #добавил выход когда сервис станет доступным
      break                     
    fi
  done
```  
3. *Необходимо написать скрипт, который проверяет доступность трёх IP: 192.168.0.1, 173.194.222.113, 87.250.250.242 по 80 порту и записывает результат в файл log. Проверять доступность необходимо пять раз для каждого узла.*  
**Ответ:**  
```shell
#!/usr/bin/env bash
declare -i ping=1
while (($ping<=5))
do
  for hosts in 192.168.0.1 173.194.222.113 87.250.250.242 
  do
    nc -zw1 $hosts 80
    echo $? $hosts - `date` >> ping_log.log
  done
ping+=1
sleep 2
done
```  
```shell
$ cat ping_log.log
0 192.168.0.1 - Wed 12 Jan 2022 08:25:53 PM UTC
0 173.194.222.113 - Wed 12 Jan 2022 08:25:53 PM UTC
0 87.250.250.242 - Wed 12 Jan 2022 08:25:53 PM UTC
0 192.168.0.1 - Wed 12 Jan 2022 08:25:55 PM UTC
0 173.194.222.113 - Wed 12 Jan 2022 08:25:55 PM UTC
0 87.250.250.242 - Wed 12 Jan 2022 08:25:55 PM UTC
0 192.168.0.1 - Wed 12 Jan 2022 08:25:57 PM UTC
0 173.194.222.113 - Wed 12 Jan 2022 08:25:57 PM UTC
0 87.250.250.242 - Wed 12 Jan 2022 08:25:57 PM UTC
0 192.168.0.1 - Wed 12 Jan 2022 08:25:59 PM UTC
0 173.194.222.113 - Wed 12 Jan 2022 08:25:59 PM UTC
0 87.250.250.242 - Wed 12 Jan 2022 08:25:59 PM UTC
0 192.168.0.1 - Wed 12 Jan 2022 08:26:01 PM UTC
0 173.194.222.113 - Wed 12 Jan 2022 08:26:01 PM UTC
0 87.250.250.242 - Wed 12 Jan 2022 08:26:01 PM UTC
```  
4. *Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается*  
**Ответ:**  
```shell
array_int=(192.168.0.1 173.194.222.113 87.250.250.242)
while ((1==1))
do
  for hosts in ${array_int[@]}
   do
    nc -zw1 $hosts 80
    stan=$? 
    if (($stan==1))
    then
      echo $stan $hosts - `date` >> error_l.log
      break 2
    else
      echo $stan $hosts - `date` >> ping_l.log
    fi
  done
sleep 1
done&
```
5. *Мы хотим, чтобы у нас были красивые сообщения для коммитов в репозиторий. Для этого нужно написать локальный хук для git, который будет проверять, что сообщение в коммите содержит код текущего задания в квадратных скобках и количество символов в сообщении не превышает 30. Пример сообщения: [04-script-01-bash] сломал хук.*  
**Ответ:**  
```shell
$ nano .git/hooks/commit-msg
#!/usr/bin/env bash 

validator=$(grep -c "\[[[:digit:]]*-[[:alpha:]]*-[[:digit:]]*-[[:alpha:]]*\] *" "$1")
count=$(cat "$1" | wc -m )

if [[ "$validator" -eq "0" ]]; then 
    echo "Commit message does not match format: [number-section-number-lecture] message"
    echo 
    echo "Commit message:"
    cat $1 | grep -v ^#
    echo
    exit 1
elif [[ "$count" -gt "30" ]]; then 
    echo "The commit message must not exceed 30 characters. It turned out $count characters"
    echo 
    echo :"Commit message:"
    cat $1 | grep -v ^#
    echo
    exit 1
fi
exit 0
```
```shell
$ chmod +x .git/hooks/commit-msg
```